class Base{constructor(){this.host=null,this.dummy=this.dummy.bind(this),this.sleep=this.sleep.bind(this),this.get=this.get.bind(this),this.http=this.http.bind(this),this.httpResponseSimple=this.httpResponseSimple.bind(this),this.httpResponseBody=this.httpResponseBody.bind(this),this.jsonParse=this.jsonParse.bind(this),this.checkIfObject=this.checkIfObject.bind(this),this.startHttpServer=this.startHttpServer.bind(this),this.startFileServer=this.startFileServer.bind(this),this.matchIpRange=this.matchIpRange.bind(this)}dummy(t,e){e(t)}sleep(t,e){this.setTimeout(e,1e3*t)}get(t,e){this.http({url:t,method:"GET",body:null},e)}http(t,e){var s=t.url,i=t.method,r=t.body,o=new XMLHttpRequest;o.open(i,s,!0),e&&(o.onreadystatechange=function(){4==o.readyState&&(o.status>=200&&o.status<=299?e({headers:o.getAllResponseHeaders(),body:o.responseText,status:o.status,statusMessage:o.statusText}):o.status>=300?e({error:`HTTP Status ${o.status}${void 0!==XMLHttpRequest.statusMessage?`, with message: ${o.statusMessage}`:""}`}):0===o.status&&e({error:"Connection interrupted"}))},o.ontimeout=function(){e({error:"Connection timed out"})}),null!==r?o.send(r):o.send()}httpResponseSimple(t){if(t.error)throw new Error(t.error);if(void 0!==t.status&&parseInt(t.status)<400)return!0;throw new Error("Framework returned with a HTTP code > 400")}httpResponseBody(t){if(t.error)throw new Error(t.error);if(void 0!==t.status&&parseInt(t.status)<400&&void 0!==t.body)return!0;throw new Error("Framework returned with a HTTP code > 400 or no body (yet expected)")}jsonParse(t,e){try{e(JSON.parse(t))}catch(t){throw new Error("Error parsing json at jsonParse step")}}checkIfObject(t){if("object"==typeof t)return!0;throw new Error(`${t} is not an Object`)}startHttpServer(t,e){throw Error("This is no longer supported in the web version, please point your test to the webserver instead")}startFileServer(t){throw Error("This is no longer supported in the web version, please point your test to the webserver instead")}matchIpRange(t,e){throw Error("This is no longer supported in the web version, local server support is disabled. Please update your test")}}window.plugins=window.plugins||{},window.plugins.Base=Base;class Framework extends Base{constructor(){super(),this.up="0x0001",this.down="0x0002",this.right="0x0004",this.left="0x0003",this.esc="0x0009",this.exit="0x0009",this.back="0x0032",this.enter="0x002B",this.menu="0x8010",this.guide="0x800A",this.key=this.key.bind(this),this.keyPress=this.keyPress.bind(this),this.keyRelease=this.keyRelease.bind(this),this.setUrl=this.setUrl.bind(this),this.setYouTubeUrl=this.setYouTubeUrl.bind(this),this.getUrl=this.getUrl.bind(this),this.controllerActionCall=this.controllerActionCall.bind(this),this.startPlugin=this.startPlugin.bind(this),this.startAndResumePlugin=this.startAndResumePlugin.bind(this),this.stopPlugin=this.stopPlugin.bind(this),this.switchPlugin=this.switchPlugin.bind(this),this.startPlugins=this.startPlugins.bind(this),this.stopPlugins=this.stopPlugins.bind(this),this.getPlugin=this.getPlugin.bind(this),this.getPlugins=this.getPlugins.bind(this),this.getPluginState=this.getPluginState.bind(this),this.suspendPlugin=this.suspendPlugin.bind(this),this.resumePlugin=this.resumePlugin.bind(this),this.screenshot=this.screenshot.bind(this),this.getFPS=this.getFPS.bind(this),this.reboot=this.reboot.bind(this),this.getCpuLoad=this.getCpuLoad.bind(this),this.getMemoryUsage=this.getMemoryUsage.bind(this),this.getMemoryUsageForPlugin=this.getMemoryUsageForPlugin.bind(this),this.restartFramework=this.restartFramework.bind(this),this.startFramework=this.startFramework.bind(this),this.stopFramework=this.stopFramework.bind(this),this.killFramework=this.killFramework.bind(this),this.killallFramework=this.killallFramework.bind(this),this.requestProvisioning=this.requestProvisioning.bind(this),this.checkResumedOrActivated=this.checkResumedOrActivated.bind(this),this.checkSuspendedOrDeactivated=this.checkSuspendedOrDeactivated.bind(this)}key(t,e){this.keyPress(t,()=>{this.keyRelease(t,e)})}keyPress(t,e){var s=JSON.stringify({code:t}),i={url:`http://${host}:80/Service/RemoteControl/Web/Press`,body:s,method:"PUT"};this.http(i,e)}keyRelease(t,e){var s=JSON.stringify({code:t}),i={url:`http://${host}:80/Service/RemoteControl/Web/Release`,body:s,method:"PUT"};this.http(i,e)}setUrl(t,e){var s=JSON.stringify({url:t}),i={url:`http://${host}:80/Service/WebKitBrowser/URL`,method:"POST",body:s,headers:{"Content-Type":"application/json","Content-Length":s.length}};this.http(i,e)}setYouTubeUrl(t,e){var s=JSON.stringify({url:t}),i={url:`http://${host}:80/Service/YouTube/URL`,method:"POST",body:s,headers:{"Content-Type":"application/json","Content-Length":s.length}};this.http(i,e)}getUrl(t,e){this.getPlugin("WebKitBrowser",t=>{var s=JSON.parse(t.body);e(s.url)})}controllerActionCall(t,e){var s={url:`http://${host}:80/Service/Controller/${t.action}/${t.plugin}`,method:"PUT"};this.http(s,e)}startPlugin(t,e){var s={action:"Activate",plugin:t};this.controllerActionCall(s,e)}startAndResumePlugin(t,e){this.startPlugin(t,()=>{setTimeout(resumePlugin,300,t,e)})}stopPlugin(t,e){var s={action:"Deactivate",plugin:t};this.controllerActionCall(s,e)}switchPlugin(t,e){var s={action:"Switch",plugin:t};this.controllerActionCall(s,e)}startPlugins(t,e){for(var s=0;s<t.length;s++)s==t.length-1?setTimeout(this.startPlugin.bind(this),1e3*s,t[s],e):setTimeout(this.startPlugin.bind(this),1e3*s,t[s])}stopPlugins(t,e){for(var s=0;s<t.length;s++)s==t.length-1?setTimeout(this.stopPlugin.bind(this),1e3*s,t[s],e):setTimeout(this.stopPlugin.bind(this),1e3*s,t[s])}getPlugin(t,e){var s={url:`http://${host}:80/Service/${t}`,method:"GET"};this.http(s,e)}getPlugins(t,e){var s={url:`http://${host}:80/Service/Controller/Plugins`,method:"GET"};this.http(s,e)}getPluginState(t,e){this.getPlugin("Controller",s=>{for(var i=JSON.parse(s.body),r=0;i.plugins.length;r++){var o=i.plugins[r];if(o.callsign===t){e(o.state);break}if(r===i.plugins.length-1)throw new Error("Plugin not found in Frameworks response")}})}suspendPlugin(t,e){var s={url:`http://${host}:80/Service/${t}/Suspend`,method:"POST"};this.http(s,e)}resumePlugin(t,e){var s={url:`http://${host}:80/Service/${t}/Resume`,method:"POST"};this.http(s,e)}reboot(t,e){var s={url:`http://${host}:80/Service/Controller/Harakiri`,method:"PUT"};this.http(s,e)}screenshot(t,e){var s=`http://${host}:80/Service/Snapshot/Capture?`+moment().valueOf();fetchImageData(s,t=>{e(t)})}getFPS(t,e){this.getPlugin("WebKitBrowser",t=>{var s=JSON.parse(t.body),i=parseInt(s.fps);e(i)})}getCpuLoad(t,e){this.getPlugin("DeviceInfo",t=>{var s=JSON.parse(t.body);if(void 0!==s.SystemInfo&&void 0===s.systeminfo)e(parseFloat(s.SystemInfo.CpuLoad));else{if(void 0!==s.SystemInfo||void 0===s.systeminfo)throw Error("Cannot find systemInfo Cpu load on DeviceInfo plugin response");e(parseFloat(s.systeminfo.cpuload))}})}getMemoryUsage(t,e){getPlugin("DeviceInfo",t=>{var s,i,r=JSON.parse(t.body);if(void 0!==r.SystemInfo&&void 0===r.systeminfo)s=parseInt(r.SystemInfo.FreeRam),i=parseInt(r.SystemInfo.TotalRam);else{if(void 0!==r.SystemInfo||void 0===r.systeminfo)throw Error("Cannot find systemInfo on DeviceInfo plugin response");s=parseInt(r.systeminfo.freeram),i=parseInt(r.systeminfo.totalram)}e(Math.round(s/i*100))})}getMemoryUsageForPlugin(t,e){this.getPlugin("Monitor",s=>{for(var i=JSON.parse(s.body),r=0;r<i.length;r++){var o=i[r];if(console.log("Checking "+o.name+" === "+t),o.name===t)return void e(o)}throw Error(`Cannot find ${t} in data returned by Monitor`)})}startFramework(t){t({})}stopFramework(t,e){e({})}killFramework(t,e){e({})}killallFramework(t,e){e({})}restartFramework(t,e){e({})}requestProvisioning(t,e){var s={url:`http://${host}:80/Service/Provisioning`,method:"PUT"};this.http(s,e)}checkResumedOrActivated(t){if("resumed"===t||"activated"===t)return!0;throw Error(`Expected state to be resumed or activated, while state was ${t}`)}checkSuspendedOrDeactivated(t){if("suspended"===t||"deactivated"===t)return!0;throw Error(`Expected state to be suspended or deactivated, while state was ${t}`)}}window.plugins=window.plugins||{},window.plugins.Framework=Framework;class AttachToLogs{constructor(t){this.cb=t,this.ws=void 0}connect(t){this.ws=new WebSocket(`ws://${host}:9998/devtools/page/1`),this.ws.addEventListener("open",()=>{this.ws.send('{"id":1,"method":"Inspector.enable"}'),this.ws.send('{"id":22,"method":"Console.enable"}'),this.ws.send('{"id":23,"method":"Inspector.initialized"}'),t()}),this.ws.addEventListener("message",t=>{var e=JSON.parse(t);"Console.messageAdded"===e.method&&this.cb(null,e.params.message.text)}),this.ws.addEventListener("error",t=>{throw Error(t)}),this.ws.addEventListener("close",()=>{console.log("connection closed")})}disconnect(){console.log("Closing attachToLogs websocket connection"),this.ws&&this.ws.close()}}window.plugins=window.plugins||{},window.plugins.AttachToLogs=AttachToLogs;